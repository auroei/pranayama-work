<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pranayama @ work</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #E5E7EB; /* text-gray-200 */
        }
        /* Custom transition for smooth background color changes */
        .transition-bg {
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        /* Style for the connector pseudo-element */
        #visualizer-panel::before {
            content: '';
            position: absolute;
            background-color: #374151; /* bg-gray-700 */
            transition: top 0.25s ease-out, height 0.25s ease-out, background-color 0.3s ease-in-out;
            z-index: 0; /* Ensure it's behind the button */
        }
    </style>
</head>
<body class="h-screen flex flex-col p-4 sm:p-6 lg:p-8">

    <!-- Header -->
    <header class="mb-6 flex-shrink-0">
        <div>
            <h1 class="text-2xl sm:text-3xl text-white">Pranayama @ work</h1>
            <p class="text-gray-400">Breath work to center yourself</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12 overflow-hidden">
        
        <!-- Left Column: Exercise Selection -->
        <div class="flex flex-col justify-center overflow-y-auto">
            <div id="exercise-list" class="space-y-3">
                <!-- Exercise items will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Right Column: Visualizer and Controls -->
        <div id="visualizer-panel" class="relative flex flex-col items-center justify-center bg-gray-700 rounded-2xl p-6 h-full transition-bg overflow-hidden">
            <div id="visualizer-content" class="text-center w-full max-w-sm h-full">
                <!-- Content will be updated by JavaScript -->
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
            const exercises = [
                {
                    id: 1,
                    title: 'Start my day',
                    description: `Uses Coherent breathing for gaining balance.`,
                    duration: 360, // 6 minutes
                    icon: `<span class="text-2xl">‚òÄÔ∏è</span>`,
                    color: '#374151', // bg-gray-700
                    stages: [
                        { name: 'Grounding', duration: 60, pattern: [{ instruction: 'Breathe Naturally', duration: 60, method: 'Nose' }] },
                        { name: 'Coherent Breathing', duration: 240, pattern: [
                            { instruction: 'Inhale', duration: 5, method: 'Nose' },
                            { instruction: 'Exhale', duration: 5, method: 'Nose' },
                        ]},
                        { name: 'Observation', duration: 60, pattern: [{ instruction: 'Breathe Naturally', duration: 60, method: 'Nose' }] }
                    ]
                },
                {
                    id: 2,
                    title: 'Recover from meetings',
                    description: `Uses Box Breathing to reset and calm.`,
                    duration: 300, // 5 minutes
                    icon: `<span class="text-2xl">üòµ‚Äçüí´</span>`,
                    color: '#374151', // bg-gray-700
                    stages: [
                        { name: 'Diaphragmatic Awareness', duration: 60, pattern: [{ instruction: 'Breathe Deeply', duration: 60, method: 'Nose' }] },
                        { name: 'Box Breathing', duration: 180, pattern: [
                            { instruction: 'Inhale', duration: 5, method: 'Nose' },
                            { instruction: 'Hold', duration: 5, method: '' },
                            { instruction: 'Exhale', duration: 5, method: 'Nose' },
                            { instruction: 'Hold', duration: 5, method: '' },
                        ]},
                        { name: 'Integration', duration: 60, pattern: [{ instruction: 'Breathe Gently', duration: 60, method: 'Nose' }] }
                    ]
                },
                {
                    id: 3,
                    title: 'Enter flow state',
                    description: `Uses 4-7-8 Breath to quiet the mind.`,
                    setupInstruction: 'Rest your tongue behind your top front teeth.',
                    duration: 420, // 7 minutes
                    icon: `<span class="text-2xl">üéØ</span>`,
                    color: '#374151', // bg-gray-700
                    stages: [
                        { name: 'Settling In', duration: 60, pattern: [{ instruction: 'Breathe Naturally', duration: 60, method: 'Nose' }] },
                        { name: '4-7-8 Breathing', duration: 300, pattern: [
                            { instruction: 'Inhale', duration: 4, method: 'Nose' },
                            { instruction: 'Hold', duration: 7, method: '' },
                            { instruction: 'Exhale', duration: 8, method: 'Mouth' },
                        ]},
                        { name: 'Silent Focus', duration: 60, pattern: [{ instruction: 'Breathe Normally', duration: 60, method: 'Nose' }] }
                    ]
                },
                {
                    id: 4,
                    title: 'Beat drowsiness',
                    description: `Uses Bhastrika to energize and awaken.`,
                    duration: 300, // 5 minutes
                    icon: `<span class="text-2xl">‚ö°Ô∏è</span>`,
                    color: '#374151', // bg-gray-700
                     stages: [
                        { name: 'Round 1', duration: 60, pattern: Array(20).fill({ instruction: 'Breathe Forcefully', duration: 1, method: 'Nose' }).concat([{ instruction: 'Deep Inhale', duration: 2, method: 'Nose' }, { instruction: 'Hold', duration: 18, method: '' }]) },
                        { name: 'Rest', duration: 30, pattern: [{ instruction: 'Breathe Normally', duration: 30, method: 'Nose' }] },
                        { name: 'Round 2', duration: 60, pattern: Array(20).fill({ instruction: 'Breathe Forcefully', duration: 1, method: 'Nose' }).concat([{ instruction: 'Deep Inhale', duration: 2, method: 'Nose' }, { instruction: 'Hold', duration: 18, method: '' }]) },
                        { name: 'Rest', duration: 30, pattern: [{ instruction: 'Breathe Normally', duration: 30, method: 'Nose' }] },
                        { name: 'Round 3', duration: 60, pattern: Array(20).fill({ instruction: 'Breathe Forcefully', duration: 1, method: 'Nose' }).concat([{ instruction: 'Deep Inhale', duration: 2, method: 'Nose' }, { instruction: 'Hold', duration: 18, method: '' }]) },
                        { name: 'Observation', duration: 60, pattern: [{ instruction: 'Breathe Naturally', duration: 60, method: 'Nose' }] }
                    ]
                },
                {
                    id: 5,
                    title: 'Decompress after long day',
                    description: `Uses Cyclic Sighing to release stress.`,
                    duration: 480, // 8 minutes
                    icon: `<span class="text-2xl">üòå</span>`,
                    color: '#374151', // bg-gray-700
                    stages: [
                        { name: 'Cyclic Sighing', duration: 120, pattern: [
                            { instruction: 'Inhale', duration: 1.5, method: 'Nose' },
                            { instruction: 'Inhale Again', duration: 0.5, method: 'Nose' },
                            { instruction: 'Long Exhale', duration: 4, method: 'Mouth' },
                        ]},
                        { name: 'Deep Relaxation', duration: 300, pattern: [
                            { instruction: 'Inhale', duration: 5, method: 'Nose' },
                            { instruction: 'Exhale', duration: 10, method: 'Mouth' },
                        ]},
                        { name: 'Restful Awareness', duration: 60, pattern: [{ instruction: 'Breathe Naturally', duration: 60, method: 'Nose' }] }
                    ]
                },
            ];

            // --- STATE ---
            let selectedExerciseId = null; // Start with no selection
            let isSessionActive = false;
            let timerInterval = null;
            let animationTimeout = null;
            let remainingTime = 0;
            let currentStageIndex = 0;
            let currentPatternIndex = 0;

            // --- DOM ELEMENTS ---
            const exerciseListEl = document.getElementById('exercise-list');
            const visualizerContentEl = document.getElementById('visualizer-content');
            
            // --- RENDER FUNCTIONS ---
            function renderExerciseList() {
                exerciseListEl.innerHTML = '';
                exercises.forEach(exercise => {
                    const isSelected = exercise.id === selectedExerciseId;
                    const itemEl = document.createElement('div');
                    itemEl.className = `transition-bg flex items-center p-4 rounded-2xl cursor-pointer border-2 ${isSelected ? 'bg-gray-700 border-blue-500 selected-item relative z-10' : 'bg-gray-800 border-transparent hover:border-gray-600'}`;
                    itemEl.dataset.id = exercise.id;
                    
                    itemEl.innerHTML = `
                        <div class="mr-4 w-12 flex-shrink-0 flex flex-col items-center">
                            <div class="text-4xl font-bold text-white">${exercise.duration / 60}</div>
                            <div class="text-sm text-gray-400">mins</div>
                        </div>
                        <div class="flex-grow">
                            <h3 class="font-semibold text-white">${exercise.title}</h3>
                            <p class="text-sm text-gray-400 exercise-description">${exercise.description}</p>
                        </div>
                        <div class="ml-4">${exercise.icon}</div>
                    `;
                    itemEl.addEventListener('click', (e) => {
                        handleExerciseSelect(exercise.id)
                    });
                    exerciseListEl.appendChild(itemEl);
                });
                updateConnector();
            }

            function renderVisualizerPanel() {
                const exercise = exercises.find(ex => ex.id === selectedExerciseId);
                
                if (!exercise) {
                    renderWelcomeState();
                    return;
                }

                remainingTime = exercise.duration;
                const initialInstruction = exercise.setupInstruction || 'Ready to begin?';

                visualizerContentEl.innerHTML = `
                    <div class="flex flex-col h-full justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-1">${exercise.title}</h3>
                            <p id="stage-name" class="text-gray-400 text-sm h-10 flex items-center justify-center">${initialInstruction}</p>
                        </div>
                        
                        <div id="visualizer-circle-container" class="relative w-48 h-48 sm:w-64 sm:h-64 flex items-center justify-center my-4 mx-auto">
                            <svg class="absolute inset-0 w-full h-full" viewBox="0 0 100 100">
                                <circle class="text-gray-800" stroke-width="5" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                                <circle id="progress-ring" class="text-green-500" stroke-width="5" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" stroke-linecap="round" style="transform: rotate(-90deg); transform-origin: 50% 50%; stroke-dasharray: 283; stroke-dashoffset: 283;" />
                            </svg>
                            <div id="visualizer-circle" class="absolute w-32 h-32 sm:w-48 sm:h-48 rounded-full flex items-center justify-center text-center" style="transition: transform 0.5s ease-in-out; background-image: radial-gradient(circle, rgba(22, 163, 74, 0.5) 0%, rgba(17, 124, 63, 0.5) 100%);">
                                <div>
                                    <div id="instruction-text" class="text-2xl font-bold text-white">Ready</div>
                                    <div id="method-text" class="text-sm text-green-300 opacity-70"></div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div id="timer" class="text-4xl font-bold text-white mb-2">${formatTime(remainingTime)}</div>
                            <p class="text-gray-400 mb-6">Remaining</p>
                            <button id="start-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-2xl transition-colors">
                                Start Session
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('start-btn').addEventListener('click', handleStartStop);
            }
            
            function renderWelcomeState() {
                visualizerContentEl.innerHTML = `
                    <div class="flex flex-col h-full items-center justify-center">
                        <div class="text-center">
                            <h3 class="text-xl font-semibold text-white mb-2">Welcome</h3>
                            <p class="text-gray-400">Please select an exercise to begin.</p>
                        </div>
                    </div>
                `;
            }

            // --- HANDLERS & LOGIC ---
            function handleExerciseSelect(id) {
                if (isSessionActive) return;
                selectedExerciseId = id;
                renderExerciseList();
                renderVisualizerPanel();
            }

            function handleStartStop() {
                if (isSessionActive) stopSession();
                else startSession();
            }

            function startSession() {
                isSessionActive = true;
                currentStageIndex = 0;
                currentPatternIndex = 0;
                const exercise = exercises.find(ex => ex.id === selectedExerciseId);
                remainingTime = exercise.duration;

                const startBtn = document.getElementById('start-btn');

                if (startBtn) {
                    startBtn.textContent = 'Stop Session';
                    startBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    startBtn.classList.add('bg-gray-600', 'hover:bg-gray-500'); // Neutral gray color
                }
                
                exerciseListEl.style.pointerEvents = 'none';
                exerciseListEl.style.opacity = '0.5';

                runTimer();
                runAnimationLoop();
            }

            function stopSession() {
                isSessionActive = false;
                clearInterval(timerInterval);
                clearTimeout(animationTimeout);
                
                exerciseListEl.style.pointerEvents = 'auto';
                exerciseListEl.style.opacity = '1';

                renderVisualizerPanel();
            }
            
            function updateConnector() {
                const selectedButton = document.querySelector('.selected-item');
                const mainGrid = document.querySelector('main');
                const visualizerPanel = document.getElementById('visualizer-panel');

                if (!selectedButton || !mainGrid || !visualizerPanel) {
                    // Hide connector if nothing is selected
                    let styleTag = document.getElementById('dynamic-connector-styles');
                    if (styleTag) styleTag.innerHTML = `#visualizer-panel::before { height: 0px; }`;
                    return;
                };

                const selectedExercise = exercises.find(ex => ex.id === selectedExerciseId);
                visualizerPanel.style.backgroundColor = selectedExercise.color;

                const buttonRect = selectedButton.getBoundingClientRect();
                const mainGridRect = mainGrid.getBoundingClientRect();

                const top = buttonRect.top - mainGridRect.top;
                const height = buttonRect.height;
                
                let styleTag = document.getElementById('dynamic-connector-styles');
                if (!styleTag) {
                    styleTag = document.createElement('style');
                    styleTag.id = 'dynamic-connector-styles';
                    document.head.appendChild(styleTag);
                }
                
                const gap = window.innerWidth >= 768 ? (window.innerWidth >= 1024 ? 48 : 32) : 32; // gap in pixels

                styleTag.innerHTML = `
                    #visualizer-panel::before {
                        top: ${top}px;
                        height: ${height}px;
                        left: -${gap}px;
                        width: ${gap}px;
                        background-color: ${selectedExercise.color};
                    }
                `;
            }

            function runTimer() {
                const exercise = exercises.find(ex => ex.id === selectedExerciseId);
                const totalDuration = exercise.duration;
                const progressRing = document.getElementById('progress-ring');
                const circumference = 2 * Math.PI * 45;

                timerInterval = setInterval(() => {
                    remainingTime--;
                    document.getElementById('timer').textContent = formatTime(remainingTime);
                    
                    const progress = (totalDuration - remainingTime) / totalDuration;
                    const offset = circumference * (1 - progress);
                    if(progressRing) progressRing.style.strokeDashoffset = offset;

                    if (remainingTime <= 0) {
                        stopSession();
                        const instructionText = document.getElementById('instruction-text');
                        if(instructionText) instructionText.textContent = 'Complete!';
                        const stageNameEl = document.getElementById('stage-name');
                        if(stageNameEl) stageNameEl.textContent = "Session finished.";
                    }
                }, 1000);
            }

            function runAnimationLoop() {
                if (!isSessionActive) return;

                const exercise = exercises.find(ex => ex.id === selectedExerciseId);
                const stage = exercise.stages[currentStageIndex];
                
                if (!stage) {
                    stopSession();
                    return;
                }
                
                const stageEndTime = exercise.stages.slice(0, currentStageIndex + 1).reduce((acc, s) => acc + s.duration, 0);
                const timeUntilNextStage = stageEndTime - (exercise.duration - remainingTime);
                
                if (timeUntilNextStage <= 3 && exercise.stages[currentStageIndex + 1]) {
                    clearTimeout(animationTimeout);
                    const visualizerCircle = document.getElementById('visualizer-circle');
                    const instructionText = document.getElementById('instruction-text');
                    const methodText = document.getElementById('method-text');
                    
                    if (visualizerCircle) visualizerCircle.style.transform = 'scale(0.85)';
                    if (instructionText) instructionText.textContent = `Prepare for...`;
                    if (methodText) methodText.textContent = exercise.stages[currentStageIndex + 1].name;

                    animationTimeout = setTimeout(() => {
                        currentStageIndex++;
                        currentPatternIndex = 0;
                        runAnimationLoop();
                    }, 3000);
                    return;
                }

                const stageNameEl = document.getElementById('stage-name');
                if (stageNameEl) stageNameEl.textContent = stage.name;

                const step = stage.pattern[currentPatternIndex % stage.pattern.length];
                
                const visualizerCircle = document.getElementById('visualizer-circle');
                const instructionText = document.getElementById('instruction-text');
                const methodText = document.getElementById('method-text');
                
                if (!visualizerCircle || !instructionText || !methodText) return;

                instructionText.textContent = step.instruction;
                methodText.textContent = step.method;
                
                visualizerCircle.style.transitionDuration = `${step.duration}s`;
                visualizerCircle.style.transitionTimingFunction = 'cubic-bezier(0.45, 0, 0.55, 1)';

                const instructionLower = step.instruction.toLowerCase();
                if (instructionLower.includes('inhale')) {
                    visualizerCircle.style.transform = 'scale(1)';
                } else if (instructionLower.includes('exhale')) {
                    visualizerCircle.style.transform = 'scale(0.7)';
                } else if (instructionLower.includes('breathe') || instructionLower.includes('rest')) {
                    visualizerCircle.style.transitionTimingFunction = 'linear';
                    visualizerCircle.style.transform = 'scale(0.85)';
                }

                animationTimeout = setTimeout(() => {
                    currentPatternIndex++;
                    runAnimationLoop();
                }, step.duration * 1000);
            }
            
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            // --- INITIALIZATION ---
            function init() {
                renderExerciseList();
                renderVisualizerPanel();
                window.addEventListener('resize', updateConnector);
            }

            init();
        });
    </script>
</body>
</html>
